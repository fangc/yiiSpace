(function(h){ChiliBook={version:"2.2",automatic:!0,automaticSelector:"code",lineNumbers:!1,codeLanguage:function(j){return(j=h(j).attr("class"))?j:""},recipeLoading:!0,recipeFolder:"",replaceSpace:"&#160;",replaceTab:"&#160;&#160;&#160;&#160;",replaceNewLine:"&#160;<br/>",selectionStyle:"position:absolute; z-index:3000; overflow:scroll; width:16em; height:9em; border:1px solid gray; padding:15px; background-color:yellow;",defaultReplacement:'<span class="$0">$$</span>',recipes:{},queue:{},unique:function(){return(new Date).valueOf()}};
h.fn.chili=function(j){function o(b,f,a){function e(a,b,d){var e=a[b][d],i=typeof e._match=="string"?e._match:e._match.source;return{recipe:a,blockName:b,stepName:d,exp:"("+i+")",length:1+(i.replace(/\\./g,"%").replace(/\[.*?\]/g,"%").match(/\((?!\?)/g)||[]).length,replacement:e._replace?e._replace:c.defaultReplacement}}function d(a){for(var b=1,e=[],d=0;d<a.length;d++){var c=a[d].exp;c=c.replace(/\\\\|\\(\d+)/g,function(a,e){return!e?a:"\\"+(b+1+parseInt(e,10))});e.push(c);b+=a[d].length}a="(?:"+
e.join("|")+")";return RegExp("((?:\\s|\\S)*?)"+a+"|((?:\\s|\\S)+)",f._case?"g":"gi")}function g(a){return a.replace(/ +/g,function(a){return a.replace(/ /g,n)})}function i(a){a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;");n&&(a=g(a));return a}function s(a,b,c,i){var h=[e(b,c,i)];return a.replace(d(h),function(){return l.apply({steps:h},arguments)})}function q(a,b,e){function d(a){a=c.recipes[c.recipeFolder+a+".js"];if(!a)throw{msg:"recipe not available"};return a}if(!b)return i(a);var f=b.split("/"),
g="",k="",j="";switch(f.length){case 1:g=f[0];break;case 2:g=f[0];k=f[1];break;case 3:g=f[0];k=f[1];j=f[2];break;default:return i(a)}try{var m;if(""==j)if(""==k){if(""!=g)return m=d(g),o(a,m)}else{m=""==g?e.recipe:d(g);if(!(k in m))return i(a);return o(a,m,k)}else{m=""==g?e.recipe:d(g);if(""==k)k=e.blockName;if(!(k in m))return i(a);if(!(j in m[k]))return i(a);return s(a,m,k,j)}}catch(n){if(n.msg&&n.msg=="recipe not available"&&(f="chili_"+c.unique(),c.recipeLoading)){var l=c.recipeFolder+g+".js";
if(c.queue[l])c.queue[l].push({cue:f,subject:a,module:b,context:e});else try{c.queue[l]=[{cue:f,subject:a,module:b,context:e}],h.getJSON(l,function(a){a=eval("("+a+")");c.recipes[l]=a;a=c.queue[l];for(var b=0,e=a.length;b<e;b++){var d=q(a[b].subject,a[b].module,a[b].context);c.replaceTab&&(d=d.replace(/\t/g,c.replaceTab));c.replaceNewLine&&(d=d.replace(/\n/g,c.replaceNewLine));h("#"+a[b].cue).replaceWith(d)}})}catch(p){alert("the recipe for '"+g+"' was not found in '"+l+"'")}return'<span id="'+f+
'">'+i(a)+"</span>"}return i(a)}}function l(){if(!arguments[0])return"";var a=this.steps,b=0,e=2,d=arguments[1],f=arguments[arguments.length-3];if(f)return i(f);else for(var c;c=a[b++];){var g=arguments;if(g[e]){a="";if(h.isFunction(c.replacement)){a=[];b=0;for(f=c.length;b<f;b++)a.push(g[e+b]);a.push(g[g.length-2]);a.push(g[g.length-1]);a=c.replacement.apply({x:function(a,b){return q(a,b,{recipe:c.recipe,blockName:c.blockName})}},a)}else a=c.replacement.replace(/(\\\$)|(?:\$\$)|(?:\$(\d+))/g,function(a,
b,d){return b?"$":d?d=="0"?c.stepName:i(g[e+parseInt(d,10)]):i(g[e])});a=a.replace(/(<span\s+class\s*=\s*(["']))((?:(?!__)\w)+\2\s*>)/ig,"$1"+c.recipe._name+"__$3");return i(d)+a}else e+=c.length}}a||(a="_main",t(f));if(!(a in f))return i(b);var n=c.replaceSpace,j=function(a,b){var d=[],c;for(c in a[b])d.push(e(a,b,c));return d}(f,a);a=d(j);return b.replace(a,function(){return l.apply({steps:j},arguments)})}function t(b){var f=b._name;if(!c.queue[f]){var a=["/* Chili -- "+f+" */"],e;for(e in b)if(e.search(/^_(?!main\b)/)<
0)for(var d in b[e]){var g=b[e][d];if("_style"in g)if(g._style.constructor==String)a.push("."+f+"__"+d+" { "+g._style+" }");else for(var i in g._style)a.push("."+f+"__"+i+" { "+g._style[i]+" }")}a=a.join("\n");if(document.createElement)b=document.createElement("style"),b.type="text/css",b.styleSheet?b.styleSheet.cssText=a:(a=document.createTextNode(a),b.appendChild(a)),document.getElementsByTagName("head")[0].appendChild(b);c.queue[f]=!0}}function u(b){var f=c.codeLanguage(b);if(""!=f){var a=c.recipeFolder+
f+".js";if(c.recipeLoading)if(c.queue[a])c.queue[a].push(b);else try{c.queue[a]=[b],h.getJSON(a,function(b){b=eval("("+b+")");c.recipes[a]=b;b=c.queue[a];for(var e=0,f=b.length;e<f;e++)p(b[e],a)})}catch(e){alert("the recipe for '"+f+"' was not found in '"+a+"'")}p(b,a)}}function p(b,f){var a=c.recipes[f];if(a){var e=h(b),d=e.text();if(d)if(d=d.replace(/\r\n?/g,"\n"),e.parent().is("pre")&&(h.browser.safari||(d=d.replace(/^\n/g,""))),a=o(d,a),c.replaceTab&&(a=a.replace(/\t/g,c.replaceTab)),c.replaceNewLine&&
(a=a.replace(/\n/g,c.replaceNewLine)),b.innerHTML=a,(h.browser.msie||h.browser.mozilla)&&v(b),a=e.parent(),d=/ln-(\d+)-([\w][\w\-]*)|ln-(\d+)|ln-/.exec(a.attr("class"))){r(b);var g=0;d[1]?(g=parseInt(d[1],10),d=h(".ln-"+d[1]+"-"+d[2]),a=d.index(a[0]),d.slice(0,a).each(function(){g+=h(this).find("li").length})):g=d[3]?parseInt(d[3],10):1;e.find("ol")[0].start=g;h("body").width(h("body").width()-1).width(h("body").width()+1)}else c.lineNumbers&&r(b)}}function v(b){var c=null;h(b).parents().filter("pre").bind("mousedown",
function(){c=this;h.browser.msie?document.selection.empty():window.getSelection().removeAllRanges()}).bind("mouseup",function(a){if(c&&c==this){c=null;var b="";if(h.browser.msie){b=document.selection.createRange().htmlText;if(""==b)return;b=w(b);var d='<textarea style="STYLE">'}else{b=window.getSelection().toString();if(""==b)return;b=b.replace(/\r/g,"").replace(/^# ?/g,"").replace(/\n# ?/g,"\n");d='<pre style="STYLE">'}b=h(d.replace(/\bSTYLE\b/,ChiliBook.selectionStyle)).appendTo("body").text(b).attr("id",
"chili_selection").click(function(){h(this).remove()});d=a.pageY-Math.round(b.height()/2)+"px";a=a.pageX-Math.round(b.width()/2)+"px";b.css({top:d,left:a});h.browser.msie?(b[0].focus(),b[0].select()):(a=window.getSelection(),a.removeAllRanges(),d=document.createRange(),d.selectNodeContents(b[0]),a.addRange(d))}})}function w(b){do var c=ChiliBook.unique();while(b.indexOf(c)>-1);var a="";if(/<br/i.test(b)||/<li/i.test(b)){/<br/i.test(b)?b=b.replace(/\<br[^>]*?\>/ig,c):/<li/i.test(b)&&(b=b.replace(/<ol[^>]*?>|<\/ol>|<li[^>]*?>/ig,
"").replace(/<\/li>/ig,c));var e=h("<pre>").appendTo("body").hide()[0];e.innerHTML=b;a=h(e).text().replace(RegExp(c,"g"),"\r\n");h(e).remove()}return a}function r(b){function f(a,b,c,d){var e=d?"</span>":"",f="";a?f="<li>"+d+b+e+"</li>":c&&(f="<li>"+d+c+e+"</li>");return f}var a=h(b).html(),e=/<br>/.test(a)?"<br>":"<BR>",d="<li>"+c.replaceSpace+"</li>";a=a.replace(/(<span [^>]+>)((?:(?:&nbsp;|\xA0)<br>)+)(.*?)(<\/span>)/ig,"$2$1$3$4").replace(/(.*?)(<span .*?>)(.*?)(?:<\/span>(?:&nbsp;|\xA0)<br>|<\/span>)/ig,
function(a,b,c,d){return/<br>/i.test(d)?(b=b.split(e),a=b.pop(),b=b.join(e),(b?b+e:"")+(a+d).replace(/((.*?)(?:&nbsp;|\xA0)<br>)|(.*)/ig,function(a,b,d,e){return f(b,d,e,c)})):a}).replace(/(<li>.*?<\/li>)|((.*?)(?:&nbsp;|\xA0)<br>)|(.+)/ig,function(a,b,c,d,e){a="";return a=b?b:f(c,d,e,"")}).replace(/<li><\/li>/ig,d);b.innerHTML="<ol>"+a+"</ol>"}var c=h.extend({},ChiliBook,j||{});this.each(function(){var b=h(this);b.trigger("chili.before_coloring");u(this);b.trigger("chili.after_coloring")});return this};
h(function(){ChiliBook.automatic&&h(ChiliBook.automaticSelector).chili()})})(jQuery);